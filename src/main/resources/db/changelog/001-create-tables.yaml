databaseChangeLog:
  - changeSet:
      id: 001
      author: yeechee
      preConditions:
        - dbms:
            type: PostgreSQL
      changes:
        - sql:
            sql: |
              WITH new_author AS (
                  INSERT INTO authors (name)
                  VALUES ('William Shakespeare')
                  RETURNING id
              )
              INSERT INTO books (author_id, name)
              SELECT new_author.id, titles.title
              FROM (VALUES ('Romeo and Juliet'), ('Hamlet')) AS titles(title)
              CROSS JOIN new_author;
#        - createTable:
#            tableName: authors
#            columns:
#              - column:
#                  name: id
#                  type: BIGINT
#                  autoIncrement: true
#                  constraints:
#                    primaryKey: true
#                    nullable: false
#                    primaryKeyName: pk_authors
#              - column:
#                  name: name
#                  type: VARCHAR(50)
#                  constraints:
#                    nullable: false
#                    unique: true
#
#        - createTable:
#            tableName: books
#            columns:
#              - column:
#                  name: id
#                  type: BIGINT
##                  generationType: auto
#
#                  autoIncrement: true
#
#                  constraints:
#                    primaryKey: true
#                    nullable: false
#              - column:
#                  name: name
#                  type: VARCHAR(50)
#                  constraints:
#                    nullable: false
#                    unique: true
#              - column:
#                  name: author_id
#                  type: BIGINT
##                  constraints:
##                    nullable: false
##                    foreignKeyName: fk_books_authors
##                    references: authors(id)
#
#        - addForeignKeyConstraint:
#            baseTableName: books
#            baseColumnNames: author_id
#            referencedTableName: authors
#            referencedColumnNames: id
#            constraintName: fk_books_authors